<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico de Carga - Malinoise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-slate-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-slate-800 mb-6">
            <i class="fas fa-chart-line mr-2"></i>
            Diagnóstico de Recursos
        </h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Estado de CDN</h2>
                <div id="cdn-status">
                    <p class="text-gray-600">Verificando...</p>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Recursos Locales</h2>
                <div id="local-status">
                    <p class="text-gray-600">Verificando...</p>
                </div>
            </div>
        </div>
        
        <div class="mt-6 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Prueba de Chart.js</h2>
            <canvas id="test-chart" width="400" height="200"></canvas>
        </div>
        
        <div class="mt-6 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Log de Consola</h2>
            <div id="console-log" class="bg-gray-100 p-4 rounded text-sm font-mono max-h-40 overflow-y-auto">
                <!-- Los logs aparecerán aquí -->
            </div>
        </div>
    </div>

    <script>
        // Interceptar console.log para mostrar en la página
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('console-log');
        
        function addToLog(message, type = 'log') {
            const logElement = document.createElement('div');
            logElement.className = type === 'error' ? 'text-red-600' : 'text-gray-800';
            logElement.textContent = `[${type.toUpperCase()}] ${message}`;
            logContainer.appendChild(logElement);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        // Verificar estado de dependencias
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado, iniciando diagnóstico...');
            
            // Verificar Tailwind CSS
            const testElement = document.createElement('div');
            testElement.className = 'bg-blue-500';
            document.body.appendChild(testElement);
            const computedStyle = window.getComputedStyle(testElement);
            const tailwindWorks = computedStyle.backgroundColor === 'rgb(59, 130, 246)';
            document.body.removeChild(testElement);
            
            // Verificar Chart.js
            const chartWorks = typeof Chart !== 'undefined';
            
            // Verificar Font Awesome
            const faTest = document.querySelector('.fas');
            const fontAwesomeWorks = faTest && window.getComputedStyle(faTest).fontFamily.includes('Font Awesome');
            
            // Actualizar estado de CDN
            document.getElementById('cdn-status').innerHTML = `
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-${tailwindWorks ? 'check text-green-500' : 'times text-red-500'} mr-2"></i>
                        <span>Tailwind CSS: ${tailwindWorks ? 'Funcionando' : 'Error'}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-${chartWorks ? 'check text-green-500' : 'times text-red-500'} mr-2"></i>
                        <span>Chart.js: ${chartWorks ? 'Funcionando' : 'Error'}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-${fontAwesomeWorks ? 'check text-green-500' : 'times text-red-500'} mr-2"></i>
                        <span>Font Awesome: ${fontAwesomeWorks ? 'Funcionando' : 'Error'}</span>
                    </div>
                </div>
            `;
            
            console.log(\`Tailwind CSS: \${tailwindWorks ? 'OK' : 'ERROR'}\`);
            console.log(\`Chart.js: \${chartWorks ? 'OK' : 'ERROR'}\`);
            console.log(\`Font Awesome: \${fontAwesomeWorks ? 'OK' : 'ERROR'}\`);
            
            // Verificar recursos locales
            const localResources = [
                { name: 'CSS Custom', url: '/css/custom.css' },
                { name: 'App Simple JS', url: '/js/app-simple.js' },
                { name: 'Auth Demo JS', url: '/js/auth-api-demo.js' }
            ];
            
            Promise.all(
                localResources.map(resource => 
                    fetch(resource.url)
                        .then(response => ({ ...resource, status: response.status }))
                        .catch(error => ({ ...resource, status: 'ERROR', error: error.message }))
                )
            ).then(results => {
                document.getElementById('local-status').innerHTML = 
                    '<div class="space-y-2">' +
                    results.map(result => 
                        \`<div class="flex items-center">
                            <i class="fas fa-\${result.status === 200 ? 'check text-green-500' : 'times text-red-500'} mr-2"></i>
                            <span>\${result.name}: \${result.status === 200 ? 'OK' : result.status}\</span>
                        </div>\`
                    ).join('') +
                    '</div>';
                
                results.forEach(result => {
                    console.log(\`\${result.name}: \${result.status === 200 ? 'OK' : 'ERROR - ' + result.status}\`);
                });
            });
            
            // Crear gráfico de prueba si Chart.js funciona
            if (chartWorks) {
                const ctx = document.getElementById('test-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Prueba de Chart.js',
                            data: [12, 19, 3, 5, 2, 3],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Gráfico de Prueba - Chart.js Funcionando'
                            }
                        }
                    }
                });
                console.log('Gráfico de prueba creado exitosamente');
            }
        });
        
        // Capturar errores globales
        window.addEventListener('error', function(e) {
            console.error('Error global capturado:', e.message, 'en', e.filename, 'línea', e.lineno);
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise rechazada:', e.reason);
        });
    </script>
</body>
</html>
