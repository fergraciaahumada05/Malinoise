<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador de Base de Datos - Malinoise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
            color: #1E293B;
        }
        .data-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }
        .json-viewer {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .action-btn {
            margin: 0.25rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary { background: #0D9488; color: white; }
        .btn-primary:hover { background: #0F766E; }
        .btn-danger { background: #DC2626; color: white; }
        .btn-danger:hover { background: #B91C1C; }
        .btn-secondary { background: #64748B; color: white; }
        .btn-secondary:hover { background: #475569; }
        .btn-success { background: #16A34A; color: white; }
        .btn-success:hover { background: #15803D; }
    </style>
</head>
<body class="bg-slate-50">

    <header class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-teal-600">Administrador de Base de Datos - Malinoise</h1>
                <div class="space-x-2">
                    <button onclick="location.href='index.html'" class="action-btn btn-secondary">Volver al Inicio</button>
                    <button onclick="location.href='dashboard.html'" class="action-btn btn-primary">Ir al Dashboard</button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8">
        
        <!-- Panel de Control de Base de Datos -->
        <div class="data-card">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">üéõÔ∏è Panel de Control</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <button onclick="refreshData()" class="action-btn btn-primary">üîÑ Actualizar Datos</button>
                <button onclick="exportData()" class="action-btn btn-success">üì• Exportar Todo</button>
                <button onclick="importData()" class="action-btn btn-secondary">üì§ Importar Datos</button>
                <button onclick="clearAllData()" class="action-btn btn-danger">üóëÔ∏è Limpiar Todo</button>
            </div>
        </div>

        <!-- Datos de Usuario -->
        <div class="data-card">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">üë§ Datos de Usuario</h2>
            <div id="userData" class="json-viewer"></div>
            <div class="mt-4 space-x-2">
                <button onclick="editUserData()" class="action-btn btn-primary">‚úèÔ∏è Editar</button>
                <button onclick="clearUserData()" class="action-btn btn-danger">üóëÔ∏è Limpiar</button>
            </div>
        </div>

        <!-- Datos de Ventas -->
        <div class="data-card">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">üí∞ Datos de Ventas</h2>
            <div id="salesData" class="json-viewer"></div>
            <div class="mt-4 space-x-2">
                <button onclick="addSampleSale()" class="action-btn btn-success">‚ûï A√±adir Venta de Ejemplo</button>
                <button onclick="clearSalesData()" class="action-btn btn-danger">üóëÔ∏è Limpiar Ventas</button>
            </div>
        </div>

        <!-- Datos de Productos -->
        <div class="data-card">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">üì¶ Inventario de Productos</h2>
            <div id="productsData" class="json-viewer"></div>
            <div class="mt-4 space-x-2">
                <button onclick="addSampleProduct()" class="action-btn btn-success">‚ûï A√±adir Producto</button>
                <button onclick="resetDefaultProducts()" class="action-btn btn-secondary">üîÑ Restaurar Por Defecto</button>
                <button onclick="clearProductsData()" class="action-btn btn-danger">üóëÔ∏è Limpiar Productos</button>
            </div>
        </div>

        <!-- Datos de Negocio -->
        <div class="data-card">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">üè¢ Configuraci√≥n de Negocio</h2>
            <div id="businessData" class="json-viewer"></div>
            <div class="mt-4 space-x-2">
                <button onclick="editBusinessData()" class="action-btn btn-primary">‚úèÔ∏è Editar Negocio</button>
                <button onclick="clearBusinessData()" class="action-btn btn-danger">üóëÔ∏è Limpiar</button>
            </div>
        </div>

        <!-- Gastos de Inversi√≥n -->
        <div class="data-card">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">üí∏ Gastos de Inversi√≥n Inicial</h2>
            <div id="expensesData" class="json-viewer"></div>
            <div class="mt-4 space-x-2">
                <button onclick="addSampleExpense()" class="action-btn btn-success">‚ûï A√±adir Gasto</button>
                <button onclick="clearExpensesData()" class="action-btn btn-danger">üóëÔ∏è Limpiar Gastos</button>
            </div>
        </div>

        <!-- Estad√≠sticas de la Base de Datos -->
        <div class="data-card">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">üìä Estad√≠sticas de la Base de Datos</h2>
            <div id="dbStats" class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <!-- Las estad√≠sticas se llenar√°n con JavaScript -->
            </div>
        </div>

    </main>

    <!-- Modal para editar datos -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <h3 id="modalTitle" class="text-lg font-semibold mb-4">Editar Datos</h3>
            <label for="editTextarea" class="block text-slate-700 font-medium mb-2">Editar datos (formato JSON)</label>
            <textarea id="editTextarea" class="w-full h-64 p-3 border border-slate-300 rounded-md font-mono text-sm" title="√Årea de edici√≥n de datos en formato JSON" placeholder="Introduce los datos en formato JSON aqu√≠"></textarea>
            <div class="mt-4 flex justify-end space-x-2">
                <button onclick="closeModal()" class="action-btn btn-secondary">Cancelar</button>
                <button onclick="saveEdit()" class="action-btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        let currentEditKey = null;

        // Funci√≥n para formatear JSON de forma legible
        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2);
        }

        // Funci√≥n para actualizar todos los datos mostrados
        function refreshData() {
            displayUserData();
            displaySalesData();
            displayProductsData();
            displayBusinessData();
            displayExpensesData();
            displayStats();
            console.log('Datos actualizados');
        }

        // Mostrar datos de usuario
        function displayUserData() {
            const userData = {
                isLoggedIn: localStorage.getItem('isLoggedIn'),
                userEmail: localStorage.getItem('userEmail'),
                userName: localStorage.getItem('userName'),
                registrationDate: localStorage.getItem('registrationDate'),
                lastLoginDate: localStorage.getItem('lastLoginDate'),
                loginMethod: localStorage.getItem('loginMethod')
            };
            document.getElementById('userData').textContent = formatJSON(userData);
        }

        // Mostrar datos de ventas
        function displaySalesData() {
            const salesData = {
                totalSales: localStorage.getItem('simulatedTotalSales'),
                netProfit: localStorage.getItem('simulatedNetProfit'),
                salesHistory: JSON.parse(localStorage.getItem('simulatedSales') || '[]')
            };
            document.getElementById('salesData').textContent = formatJSON(salesData);
        }

        // Mostrar datos de productos
        function displayProductsData() {
            const productsData = JSON.parse(localStorage.getItem('simulatedProducts') || '[]');
            document.getElementById('productsData').textContent = formatJSON(productsData);
        }

        // Mostrar datos de negocio
        function displayBusinessData() {
            const businessData = JSON.parse(localStorage.getItem('currentBusiness') || '{}');
            document.getElementById('businessData').textContent = formatJSON(businessData);
        }

        // Mostrar gastos de inversi√≥n
        function displayExpensesData() {
            const expensesData = JSON.parse(localStorage.getItem('initialExpenses') || '[]');
            document.getElementById('expensesData').textContent = formatJSON(expensesData);
        }

        // Mostrar estad√≠sticas
        function displayStats() {
            const totalSales = parseFloat(localStorage.getItem('simulatedTotalSales') || '0');
            const salesCount = JSON.parse(localStorage.getItem('simulatedSales') || '[]').length;
            const productsCount = JSON.parse(localStorage.getItem('simulatedProducts') || '[]').length;
            const totalStock = JSON.parse(localStorage.getItem('simulatedProducts') || '[]')
                .reduce((sum, product) => sum + (product.stock > -1 ? product.stock : 0), 0);

            document.getElementById('dbStats').innerHTML = `
                <div class="bg-teal-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-teal-600">‚Ç¨${totalSales.toLocaleString('es-ES')}</h4>
                    <p class="text-sm text-slate-600">Ventas Totales</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-blue-600">${salesCount}</h4>
                    <p class="text-sm text-slate-600">Transacciones</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-green-600">${productsCount}</h4>
                    <p class="text-sm text-slate-600">Productos</p>
                </div>
            `;
        }

        // Funciones de edici√≥n
        function editUserData() {
            const userData = {
                isLoggedIn: localStorage.getItem('isLoggedIn'),
                userEmail: localStorage.getItem('userEmail'),
                userName: localStorage.getItem('userName'),
                registrationDate: localStorage.getItem('registrationDate'),
                lastLoginDate: localStorage.getItem('lastLoginDate'),
                loginMethod: localStorage.getItem('loginMethod')
            };
            openModal('Editar Datos de Usuario', formatJSON(userData), 'userData');
        }

        function editBusinessData() {
            const businessData = JSON.parse(localStorage.getItem('currentBusiness') || '{}');
            openModal('Editar Configuraci√≥n de Negocio', formatJSON(businessData), 'currentBusiness');
        }

        // Funciones de limpieza
        function clearUserData() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los datos de usuario? Esto cerrar√° la sesi√≥n.')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('userName');
                localStorage.removeItem('registrationDate');
                localStorage.removeItem('lastLoginDate');
                localStorage.removeItem('loginMethod');
                refreshData();
                alert('Datos de usuario eliminados');
            }
        }

        function clearSalesData() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los datos de ventas?')) {
                localStorage.removeItem('simulatedTotalSales');
                localStorage.removeItem('simulatedNetProfit');
                localStorage.removeItem('simulatedSales');
                refreshData();
                alert('Datos de ventas eliminados');
            }
        }

        function clearProductsData() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los productos?')) {
                localStorage.removeItem('simulatedProducts');
                refreshData();
                alert('Productos eliminados');
            }
        }

        function clearBusinessData() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar la configuraci√≥n del negocio?')) {
                localStorage.removeItem('currentBusiness');
                refreshData();
                alert('Configuraci√≥n de negocio eliminada');
            }
        }

        function clearExpensesData() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los gastos de inversi√≥n?')) {
                localStorage.removeItem('initialExpenses');
                refreshData();
                alert('Gastos de inversi√≥n eliminados');
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ADVERTENCIA: Esto eliminar√° TODOS los datos de la aplicaci√≥n. ¬øEst√°s seguro?')) {
                localStorage.clear();
                refreshData();
                alert('Todos los datos han sido eliminados');
            }
        }

        // Funciones para a√±adir datos de ejemplo
        function addSampleSale() {
            const sales = JSON.parse(localStorage.getItem('simulatedSales') || '[]');
            const newSale = {
                product: 'Producto de Ejemplo',
                quantity: Math.floor(Math.random() * 10) + 1,
                price: Math.round((Math.random() * 200 + 50) * 100) / 100,
                date: new Date().toISOString().split('T')[0]
            };
            sales.unshift(newSale);
            localStorage.setItem('simulatedSales', JSON.stringify(sales));
            
            // Actualizar totales
            const currentTotal = parseFloat(localStorage.getItem('simulatedTotalSales') || '0');
            const newTotal = currentTotal + (newSale.quantity * newSale.price);
            localStorage.setItem('simulatedTotalSales', newTotal.toString());
            
            refreshData();
            alert('Venta de ejemplo a√±adida');
        }

        function addSampleProduct() {
            const products = JSON.parse(localStorage.getItem('simulatedProducts') || '[]');
            const productNum = products.length + 1;
            const newProduct = {
                id: `P${productNum.toString().padStart(3, '0')}`,
                name: `Producto Ejemplo ${productNum}`,
                sku: `SKU${productNum.toString().padStart(3, '0')}`,
                stock: Math.floor(Math.random() * 100) + 10,
                price: Math.round((Math.random() * 100 + 20) * 100) / 100
            };
            products.push(newProduct);
            localStorage.setItem('simulatedProducts', JSON.stringify(products));
            refreshData();
            alert('Producto de ejemplo a√±adido');
        }

        function addSampleExpense() {
            const expenses = JSON.parse(localStorage.getItem('initialExpenses') || '[]');
            const expenseTypes = ['Equipo de oficina', 'Software', 'Marketing inicial', 'Licencias', 'Formaci√≥n'];
            const randomType = expenseTypes[Math.floor(Math.random() * expenseTypes.length)];
            const newExpense = {
                name: randomType,
                amount: Math.round((Math.random() * 5000 + 500) * 100) / 100
            };
            expenses.push(newExpense);
            localStorage.setItem('initialExpenses', JSON.stringify(expenses));
            refreshData();
            alert('Gasto de ejemplo a√±adido');
        }

        function resetDefaultProducts() {
            const defaultProducts = [
                { id: 'P001', name: 'Producto A', sku: 'SKU001', stock: 95, price: 50.00 },
                { id: 'P002', name: 'Producto B', sku: 'SKU002', stock: 118, price: 150.00 },
                { id: 'P003', name: 'Producto C', sku: 'SKU003', stock: 200, price: 25.00 },
                { id: 'S001', name: 'Servicio Consultor√≠a', sku: 'SVC001', stock: -1, price: 2500.00 }
            ];
            localStorage.setItem('simulatedProducts', JSON.stringify(defaultProducts));
            refreshData();
            alert('Productos restaurados a valores por defecto');
        }

        // Funciones de exportar/importar
        function exportData() {
            const allData = {
                userData: {
                    isLoggedIn: localStorage.getItem('isLoggedIn'),
                    userEmail: localStorage.getItem('userEmail'),
                    userName: localStorage.getItem('userName'),
                    registrationDate: localStorage.getItem('registrationDate'),
                    lastLoginDate: localStorage.getItem('lastLoginDate'),
                    loginMethod: localStorage.getItem('loginMethod')
                },
                salesData: {
                    totalSales: localStorage.getItem('simulatedTotalSales'),
                    netProfit: localStorage.getItem('simulatedNetProfit'),
                    sales: JSON.parse(localStorage.getItem('simulatedSales') || '[]')
                },
                products: JSON.parse(localStorage.getItem('simulatedProducts') || '[]'),
                business: JSON.parse(localStorage.getItem('currentBusiness') || '{}'),
                expenses: JSON.parse(localStorage.getItem('initialExpenses') || '[]'),
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `malinoise-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('Datos exportados exitosamente');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // Importar datos de usuario
                            if (data.userData) {
                                Object.keys(data.userData).forEach(key => {
                                    if (data.userData[key] !== null && data.userData[key] !== undefined) {
                                        localStorage.setItem(key, data.userData[key]);
                                    }
                                });
                            }
                            
                            // Importar datos de ventas
                            if (data.salesData) {
                                if (data.salesData.totalSales) localStorage.setItem('simulatedTotalSales', data.salesData.totalSales);
                                if (data.salesData.netProfit) localStorage.setItem('simulatedNetProfit', data.salesData.netProfit);
                                if (data.salesData.sales) localStorage.setItem('simulatedSales', JSON.stringify(data.salesData.sales));
                            }
                            
                            // Importar otros datos
                            if (data.products) localStorage.setItem('simulatedProducts', JSON.stringify(data.products));
                            if (data.business) localStorage.setItem('currentBusiness', JSON.stringify(data.business));
                            if (data.expenses) localStorage.setItem('initialExpenses', JSON.stringify(data.expenses));
                            
                            refreshData();
                            alert('Datos importados exitosamente');
                        } catch (error) {
                            alert('Error al importar datos: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Funciones del modal
        function openModal(title, content, key) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('editTextarea').value = content;
            currentEditKey = key;
            document.getElementById('editModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditKey = null;
        }

        function saveEdit() {
            try {
                const content = document.getElementById('editTextarea').value;
                
                if (currentEditKey === 'userData') {
                    const userData = JSON.parse(content);
                    Object.keys(userData).forEach(key => {
                        if (userData[key] !== null && userData[key] !== undefined) {
                            localStorage.setItem(key, userData[key]);
                        }
                    });
                } else {
                    const data = JSON.parse(content);
                    localStorage.setItem(currentEditKey, JSON.stringify(data));
                }
                
                closeModal();
                refreshData();
                alert('Datos guardados exitosamente');
            } catch (error) {
                alert('Error al guardar: JSON inv√°lido. ' + error.message);
            }
        }

        // Cargar datos al iniciar la p√°gina
        document.addEventListener('DOMContentLoaded', refreshData);
    </script>

</body>
</html>
