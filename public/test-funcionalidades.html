<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Funcionalidades - Malinoise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/custom.css">
    <script src="js/auth-api-demo.js" defer></script>
    <script src="js/app-simple.js" defer></script>
</head>
<body class="bg-slate-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-slate-800 mb-6">
            <i class="fas fa-vial mr-2"></i>
            Prueba de Funcionalidades Malinoise
        </h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Prueba de Notificaciones -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-bell mr-2"></i>
                    Notificaciones
                </h2>
                <div class="space-y-2">
                    <button onclick="testNotification('success')" class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        Éxito
                    </button>
                    <button onclick="testNotification('error')" class="w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                        Error
                    </button>
                    <button onclick="testNotification('warning')" class="w-full bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                        Advertencia
                    </button>
                    <button onclick="testNotification('info')" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        Información
                    </button>
                </div>
            </div>
            
            <!-- Prueba de Autenticación -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-user-lock mr-2"></i>
                    Autenticación Demo
                </h2>
                <div class="space-y-2">
                    <button onclick="testLogin()" class="w-full bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600">
                        Login Demo
                    </button>
                    <button onclick="testRegister()" class="w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                        Registro Demo
                    </button>
                    <button onclick="testLogout()" class="w-full bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                        Logout
                    </button>
                    <button onclick="checkSession()" class="w-full bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                        Verificar Sesión
                    </button>
                </div>
            </div>
            
            <!-- Prueba de Gráficos -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-chart-bar mr-2"></i>
                    Gráfico Chart.js
                </h2>
                <canvas id="test-chart" width="300" height="200"></canvas>
                <button onclick="updateChart()" class="w-full mt-4 bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                    Actualizar Datos
                </button>
            </div>
        </div>
        
        <!-- Estado de Dependencias -->
        <div class="mt-6 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-cogs mr-2"></i>
                Estado de Dependencias
            </h2>
            <div id="dependency-status" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Se llenará dinámicamente -->
            </div>
        </div>
        
        <!-- CSS Animations Test -->
        <div class="mt-6 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-magic mr-2"></i>
                Prueba de Animaciones CSS
            </h2>
            <div class="flex flex-wrap gap-4">
                <div class="animate-pulse bg-blue-500 text-white px-4 py-2 rounded">
                    Animación Pulse
                </div>
                <div class="animate-bounce bg-green-500 text-white px-4 py-2 rounded">
                    Animación Bounce
                </div>
                <div class="animate-spin bg-red-500 text-white px-4 py-2 rounded">
                    <i class="fas fa-spinner"></i>
                </div>
                <div class="hover:scale-110 transform transition-transform bg-purple-500 text-white px-4 py-2 rounded cursor-pointer">
                    Hover Scale
                </div>
            </div>
        </div>
        
        <!-- Log de Actividad -->
        <div class="mt-6 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-terminal mr-2"></i>
                Log de Actividad
            </h2>
            <div id="activity-log" class="bg-gray-100 p-4 rounded text-sm font-mono max-h-40 overflow-y-auto">
                <!-- Los logs aparecerán aquí -->
            </div>
            <button onclick="clearLog()" class="mt-2 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                Limpiar Log
            </button>
        </div>
    </div>

    <script>
        let testChart;
        
        // Función para añadir al log
        function addToLog(message, type = 'info') {
            const log = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type === 'error' ? 'text-red-600' : type === 'success' ? 'text-green-600' : 'text-gray-800';
            logEntry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
        }
        
        // Función para limpiar log
        function clearLog() {
            document.getElementById('activity-log').innerHTML = '';
            addToLog('Log limpiado');
        }
        
        // Pruebas de notificaciones
        function testNotification(type) {
            const messages = {
                success: '¡Operación exitosa!',
                error: 'Error de prueba detectado',
                warning: 'Advertencia de ejemplo',
                info: 'Información de prueba'
            };
            
            if (typeof showNotification === 'function') {
                showNotification(messages[type], type);
                addToLog(`Notificación ${type} mostrada`, 'success');
            } else {
                alert(`Función showNotification no disponible. Mensaje: ${messages[type]}`);
                addToLog('Función showNotification no encontrada', 'error');
            }
        }
        
        // Pruebas de autenticación
        async function testLogin() {
            try {
                addToLog('Iniciando prueba de login...');
                if (window.authAPI && typeof window.authAPI.login === 'function') {
                    const result = await window.authAPI.login('demo@malinoise.com', 'demo123');
                    addToLog('Login exitoso: ' + JSON.stringify(result), 'success');
                    if (typeof showNotification === 'function') {
                        showNotification('Login demo exitoso', 'success');
                    }
                } else {
                    addToLog('authAPI no disponible', 'error');
                }
            } catch (error) {
                addToLog('Error en login: ' + error.message, 'error');
            }
        }
        
        async function testRegister() {
            try {
                addToLog('Iniciando prueba de registro...');
                if (window.authAPI && typeof window.authAPI.register === 'function') {
                    const result = await window.authAPI.register({
                        name: 'Usuario Test',
                        email: 'test@test.com',
                        password: 'test123'
                    });
                    addToLog('Registro exitoso: ' + JSON.stringify(result), 'success');
                    if (typeof showNotification === 'function') {
                        showNotification('Registro demo exitoso', 'success');
                    }
                } else {
                    addToLog('authAPI no disponible', 'error');
                }
            } catch (error) {
                addToLog('Error en registro: ' + error.message, 'error');
            }
        }
        
        async function testLogout() {
            try {
                addToLog('Iniciando logout...');
                if (window.authAPI && typeof window.authAPI.logout === 'function') {
                    const result = await window.authAPI.logout();
                    addToLog('Logout exitoso', 'success');
                    if (typeof showNotification === 'function') {
                        showNotification('Logout exitoso', 'success');
                    }
                } else {
                    addToLog('authAPI no disponible', 'error');
                }
            } catch (error) {
                addToLog('Error en logout: ' + error.message, 'error');
            }
        }
        
        async function checkSession() {
            try {
                addToLog('Verificando sesión...');
                if (window.authAPI && typeof window.authAPI.checkSession === 'function') {
                    const result = await window.authAPI.checkSession();
                    addToLog('Sesión verificada: ' + JSON.stringify(result), 'success');
                } else {
                    addToLog('authAPI no disponible', 'error');
                }
            } catch (error) {
                addToLog('Error verificando sesión: ' + error.message, 'error');
            }
        }
        
        // Función para actualizar el gráfico
        function updateChart() {
            if (testChart) {
                const newData = Array.from({length: 6}, () => Math.floor(Math.random() * 100));
                testChart.data.datasets[0].data = newData;
                testChart.update();
                addToLog('Gráfico actualizado con nuevos datos', 'success');
            }
        }
        
        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            addToLog('DOM cargado, iniciando pruebas...');
            
            // Verificar estado de dependencias
            const dependencies = [
                { name: 'Tailwind CSS', check: () => getComputedStyle(document.body).getPropertyValue('--tw-bg-opacity') !== '' },
                { name: 'Chart.js', check: () => typeof Chart !== 'undefined' },
                { name: 'Font Awesome', check: () => document.querySelector('.fas') && getComputedStyle(document.querySelector('.fas')).fontFamily.includes('Font Awesome') },
                { name: 'showNotification', check: () => typeof showNotification === 'function' },
                { name: 'authAPI', check: () => typeof window.authAPI !== 'undefined' }
            ];
            
            const statusContainer = document.getElementById('dependency-status');
            dependencies.forEach(dep => {
                const status = dep.check();
                const statusElement = document.createElement('div');
                statusElement.className = `text-center p-3 rounded ${status ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
                statusElement.innerHTML = `
                    <i class="fas fa-${status ? 'check' : 'times'} mb-2 text-xl"></i>
                    <div class="font-semibold">${dep.name}</div>
                    <div class="text-sm">${status ? 'OK' : 'ERROR'}</div>
                `;
                statusContainer.appendChild(statusElement);
                addToLog(`${dep.name}: ${status ? 'OK' : 'ERROR'}`, status ? 'success' : 'error');
            });
            
            // Crear gráfico de prueba
            if (typeof Chart !== 'undefined') {
                const ctx = document.getElementById('test-chart').getContext('2d');
                testChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Ventas', 'Marketing', 'Desarrollo', 'Soporte'],
                        datasets: [{
                            data: [30, 25, 35, 10],
                            backgroundColor: [
                                '#0D9488',
                                '#F59E0B',
                                '#3B82F6',
                                '#EF4444'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                addToLog('Gráfico Chart.js creado exitosamente', 'success');
            } else {
                addToLog('Chart.js no disponible', 'error');
            }
            
            addToLog('Inicialización de pruebas completada');
        });
    </script>
</body>
</html>
